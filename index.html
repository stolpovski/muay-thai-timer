<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
    <title>Muay Thai Timer</title>
    <style>
        body {
            /*margin-top: 10em;*/
            text-align: center;
            background-color: black;

        }

        button {
            font-size: 18pt;
            font-weight: bold;
            background-color: tomato;
            color: rgb(80, 18, 8);
            padding: .5em 1em;
            border: none;
            border-radius: 1em;
            text-transform: uppercase;
        }

        #root {
            margin: 2em auto;
            /* background-color: red; */
            width: 14em;
            text-align: center;
            
        }

        #state {
            /* background-color: turquoise; */
            color: white;
            font-size: 14pt;
            line-height: 14pt;
            text-transform: uppercase;
            padding-top: .2em;
        }

        #countdown {
            /*background: red;*/
            padding-bottom: .2em;
            font-size: 40pt;
            color: white;
            /*font-weight: bold;*/
        }
        .logo {
            /* background-color: yellow; */
            height: 10em;
            background-image: url('logo.jpg');
            background-repeat: no-repeat;
            background-size: contain;
            background-position: top center;
        }
    </style>
</head>

<body>
    <div id="root">
        <div class="logo"></div>
        <div id="state"></div>
        <div id="countdown"></div>
        <button id="btn">Run</button>
    </div>
    <script>


        const data = [
            { src: 'bell.mp3', title: 'Get ready!' },
            { src: '1.mp3', title: 'Round 1' },
            { src: '2.mp3', title: 'Round 2' },
            { src: '3.mp3', title: 'Round 3' },
            { src: '4.mp3', title: 'Round 4' },
            { src: '5.mp3', title: 'Round 5' },
        ]

        const audio = []
        let cur

        function makeClock(seconds) {
            seconds = Math.trunc(seconds)
            let min = seconds / 60
            let sec = seconds % 60

            return parseInt(min) + ':' + (sec < 10 ? '0' : '') + sec
        }

        function init() {
            data.forEach((f, i) => {
                let a = new Audio(f.src)
                a.load()
                a.title = f.title

                a.onloadeddata = (e) => {
                    e.target.dur = e.target.duration
                    if (i === 0) {
                        countdown.innerText = makeClock(e.target.dur)
                    }
                }

                audio.push(a)
            })




           



            audio.forEach((a, i) => {
                
                a.onplay = (e) => {
                    cur = e.target
                    state.innerText = cur.title
                    countdown.innerText = makeClock(cur.dur)
                }

                a.ontimeupdate = (e) => {
                    
                    countdown.innerText = makeClock(e.target.dur - e.target.currentTime)
                }

                a.onended = (e) => {
                    if (i < audio.length - 1) {
                        audio[i + 1].play()
                    } else {
                        e.target.title = 'Final'
                        state.innerText = e.target.title
                        reset = false
                        btn.innerText = 'Run'
                        countdown.innerText = makeClock(audio[0].dur)
                    }

                }
            })

        }


        let reset = false


        document.addEventListener('DOMContentLoaded', (e) => {
            const state = document.getElementById('state')
            const countdown = document.getElementById('countdown')
            countdown.innerText = makeClock(0)
            const btn = document.getElementById('btn')

            state.innerText = document.title


            init()





            btn.onclick = () => {

                if (reset) {
                    reset = !reset
                    cur.pause()
                    cur.currentTime=0
                    cur = audio[0]
                    cur.currentTime=0
                    state.innerText=document.title
                    countdown.innerText = makeClock(cur.dur)
                    btn.innerText = 'Run'


                    return
                }

                reset = !reset

                btn.innerText = 'Stop'

                audio[0].load()
                audio[0].play()

            }
        })












    </script>
</body>

</html>